name: "ðŸš¨ VULNERABLE - PR Validation"

# DANGEROUS: This workflow is intentionally vulnerable for demo purposes
# DO NOT use this pattern in production!

on:
  pull_request_target:  # ðŸš¨ Dangerous trigger with write permissions
    types: [opened, synchronize]

jobs:
  validate-pr:
    runs-on: ubuntu-latest
    # ðŸš¨ Missing permissions restriction - defaults to write-all
    steps:
      - name: "ðŸš¨ Checkout untrusted PR code"
        uses: actions/checkout@v4
        with:
          # ðŸš¨ CRITICAL VULNERABILITY: Checking out attacker's code
          ref: ${{ github.event.pull_request.head.sha }}
          
      - name: "ðŸš¨ Install dependencies from untrusted package.json"
        run: |
          # ðŸš¨ This will execute any malicious postinstall scripts
          npm install
          
      - name: "ðŸš¨ Run tests from untrusted code"
        run: |
          # ðŸš¨ This executes attacker's test scripts
          npm test
          
      - name: "ðŸš¨ Execute custom script"
        run: |
          # ðŸš¨ This runs any script the attacker provides
          if [ -f "custom-check.sh" ]; then
            chmod +x custom-check.sh
            ./custom-check.sh
          fi
          
      - name: "Show token permissions (for demo)"
        run: |
          echo "Current permissions with GITHUB_TOKEN:"
          curl -H "Authorization: token $GITHUB_TOKEN" \
               https://api.github.com/repos/${{ github.repository }} \
               | jq '.permissions'
